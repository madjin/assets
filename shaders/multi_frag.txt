#version 130

uniform int iUseTexture0; //use texture (0 - no, 1 - yes)?
uniform sampler2D iTexture0; //samples from a texture defined on an object using the tex attribute
uniform int iUseTexture1; //use texture (0 - no, 1 - yes)?
uniform sampler2D iTexture1; //samples from a texture defined on an object using the tex attribute

uniform int iUseClipPlane; //use clip plane (0 - no, 1 - yes)?  (i.e. is the room viewed through a portal)
uniform vec4 iClipPlane; //equation of clip plane (xyz are normal, w is the offset, room is on side facing normal)

varying vec3 iPositionWorld;

void main (void)
{

    //clipping plane part of shader
    if (iUseClipPlane == 1 && dot(iPositionWorld, iClipPlane.xyz) < iClipPlane.w) {
        discard;	
    }

    vec4 texval1 = texture2D(iTexture0, vec2(gl_TexCoord[0]));  
  
    if (iUseTexture1 == 0) {
        gl_FragColor = texval1;
    }
    else {
	vec4 texval2 = texture2D(iTexture1, vec2(gl_TexCoord[1]));           
        gl_FragColor = texval1 * texval2;    
    }

}
	
